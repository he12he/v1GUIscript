local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- =======================
-- SETTINGS
-- =======================
local correctKey = "1234"
local flySpeed = 50
local flying = false
local bv, bg
local dragging = false
local minSpeed, maxSpeed = 10, 150

local aimbotEnabled = false
local fovValue = 100
local fovCircleEnabled = false
local draggingSlider = false

-- =======================
-- DRAG FUNCTION
-- =======================
local function makeDraggable(frame, dragHandle)
	local draggingLocal = false
	local dragStart, startPos

	dragHandle.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 
			or input.UserInputType == Enum.UserInputType.Touch then
			draggingLocal = true
			dragStart = input.Position
			startPos = frame.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					draggingLocal = false
				end
			end)
		end
	end)

	dragHandle.InputChanged:Connect(function(input)
		if draggingLocal and (input.UserInputType == Enum.UserInputType.MouseMovement 
			or input.UserInputType == Enum.UserInputType.Touch) then
			local delta = input.Position - dragStart
			frame.Position = UDim2.new(
				startPos.X.Scale,
				startPos.X.Offset + delta.X,
				startPos.Y.Scale,
				startPos.Y.Offset + delta.Y
			)
		end
	end)
end

-- =======================
-- GUI SETUP
-- =======================
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "KeyFlySystem"
screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
screenGui.ResetOnSpawn = false

-- Key Frame
local keyFrame = Instance.new("Frame")
keyFrame.Size = UDim2.new(0, 300, 0, 150)
keyFrame.AnchorPoint = Vector2.new(0.5, 0.5)
keyFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
keyFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
keyFrame.Parent = screenGui
Instance.new("UICorner", keyFrame).CornerRadius = UDim.new(0, 15)

local keyTitle = Instance.new("TextLabel")
keyTitle.Size = UDim2.new(1, 0, 0, 50)
keyTitle.BackgroundTransparency = 1
keyTitle.Text = "Please enter the key!"
keyTitle.Font = Enum.Font.SourceSansBold
keyTitle.TextSize = 22
keyTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
keyTitle.Parent = keyFrame

local textBox = Instance.new("TextBox")
textBox.Size = UDim2.new(0.8, 0, 0, 40)
textBox.Position = UDim2.new(0.1, 0, 0.5, -20)
textBox.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
textBox.Text = ""
textBox.PlaceholderText = "Key"
textBox.TextScaled = true
textBox.TextColor3 = Color3.fromRGB(255, 255, 255)
textBox.Parent = keyFrame
Instance.new("UICorner", textBox).CornerRadius = UDim.new(0, 8)

makeDraggable(keyFrame, keyTitle)

-- Main Menu
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 400, 0, 300)
mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
mainFrame.Visible = false
mainFrame.Parent = screenGui
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 15)

-- Top Bar
local topBar = Instance.new("Frame", mainFrame)
topBar.Size = UDim2.new(1, 0, 0, 35)
topBar.BackgroundColor3 = Color3.fromRGB(25, 25, 25)

local titleLabel = Instance.new("TextLabel", topBar)
titleLabel.Size = UDim2.new(1, -105, 1, 0)
titleLabel.Position = UDim2.new(0, 10, 0, 0)
titleLabel.Text = "V1 Fly Gui"
titleLabel.Font = Enum.Font.SourceSansBold
titleLabel.TextSize = 20
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.BackgroundTransparency = 1
titleLabel.TextXAlignment = Enum.TextXAlignment.Left

local closeButton = Instance.new("TextButton", topBar)
closeButton.Size = UDim2.new(0, 35, 1, 0)
closeButton.Position = UDim2.new(1, -35, 0, 0)
closeButton.Text = "X"
closeButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
closeButton.Font = Enum.Font.SourceSansBold
closeButton.TextSize = 20
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)

local minimizeButton = Instance.new("TextButton", topBar)
minimizeButton.Size = UDim2.new(0, 35, 1, 0)
minimizeButton.Position = UDim2.new(1, -70, 0, 0)
minimizeButton.Text = "-"
minimizeButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
minimizeButton.Font = Enum.Font.SourceSansBold
minimizeButton.TextSize = 20
minimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)

-- Frames
local categoryFrame = Instance.new("Frame", mainFrame)
categoryFrame.Size = UDim2.new(0, 100, 1, -35)
categoryFrame.Position = UDim2.new(0, 0, 0, 35)
categoryFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)

local contentFrame = Instance.new("Frame", mainFrame)
contentFrame.Size = UDim2.new(1, -100, 1, -35)
contentFrame.Position = UDim2.new(0, 100, 0, 35)
contentFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)

makeDraggable(mainFrame, topBar)

-- =======================
-- CATEGORY BUTTON SYSTEM
-- =======================
local flyContent = Instance.new("Frame", contentFrame)
flyContent.Size = UDim2.new(1,0,1,0)
flyContent.BackgroundTransparency = 1
flyContent.Visible = true

local playerContent = Instance.new("Frame", contentFrame)
playerContent.Size = UDim2.new(1,0,1,0)
playerContent.BackgroundTransparency = 1
playerContent.Visible = false

local aimbotContent = Instance.new("Frame", contentFrame)
aimbotContent.Size = UDim2.new(1,0,1,0)
aimbotContent.BackgroundTransparency = 1
aimbotContent.Visible = false

local function createCategoryButton(name, yPos, callback)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(1,0,0,40)
	btn.Position = UDim2.new(0,0,0,yPos)
	btn.Text = name
	btn.BackgroundColor3 = Color3.fromRGB(50,50,50)
	btn.Font = Enum.Font.SourceSansBold
	btn.TextSize = 20
	btn.TextColor3 = Color3.fromRGB(255,255,255)
	btn.Parent = categoryFrame
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0,8)
	btn.MouseButton1Click:Connect(callback)
end

createCategoryButton("Fly",10,function()
	flyContent.Visible=true
	playerContent.Visible=false
	aimbotContent.Visible=false
end)

createCategoryButton("Player",55,function()
	flyContent.Visible=false
	playerContent.Visible=true
	aimbotContent.Visible=false
end)

createCategoryButton("Aimbot",100,function()
	flyContent.Visible=false
	playerContent.Visible=false
	aimbotContent.Visible=true
end)

-- =======================
-- FLY TAB
-- =======================
local flyButton = Instance.new("TextButton", flyContent)
flyButton.Size = UDim2.new(0.4,0,0,40)
flyButton.Position = UDim2.new(0.05,0,0.05,0)
flyButton.Text = "Aus"
flyButton.BackgroundColor3 = Color3.fromRGB(80,80,80)
flyButton.Font = Enum.Font.SourceSansBold
flyButton.TextSize = 20
flyButton.TextColor3 = Color3.fromRGB(255,255,255)
Instance.new("UICorner",flyButton).CornerRadius = UDim.new(0,8)

local sliderFrame = Instance.new("Frame",flyContent)
sliderFrame.Size = UDim2.new(0.9,0,0,20)
sliderFrame.Position = UDim2.new(0.05,0,0.3,0)
sliderFrame.BackgroundColor3 = Color3.fromRGB(70,70,70)
Instance.new("UICorner",sliderFrame).CornerRadius = UDim.new(0,10)

local sliderButton = Instance.new("Frame",sliderFrame)
sliderButton.Size = UDim2.new(0,20,1,0)
sliderButton.Position = UDim2.new((flySpeed-minSpeed)/(maxSpeed-minSpeed),-10,0,0)
sliderButton.BackgroundColor3 = Color3.fromRGB(255,255,0)
Instance.new("UICorner",sliderButton).CornerRadius = UDim.new(1,0)

local speedLabel = Instance.new("TextLabel",flyContent)
speedLabel.Size = UDim2.new(1,0,0,30)
speedLabel.Position = UDim2.new(0,0,0.45,0)
speedLabel.Text = "Speed: "..flySpeed
speedLabel.TextColor3 = Color3.fromRGB(255,255,255)
speedLabel.BackgroundTransparency = 1
speedLabel.Font = Enum.Font.SourceSans
speedLabel.TextSize = 20

-- =======================
-- PLAYER TAB (RESPAWN)
-- =======================
local respawnButton = Instance.new("TextButton",playerContent)
respawnButton.Size = UDim2.new(0.5,0,0,40)
respawnButton.Position = UDim2.new(0.25,0,0.2,0)
respawnButton.Text = "Respawn"
respawnButton.BackgroundColor3 = Color3.fromRGB(100,100,255)
respawnButton.Font = Enum.Font.SourceSansBold
respawnButton.TextSize = 20
respawnButton.TextColor3 = Color3.fromRGB(255,255,255)
Instance.new("UICorner",respawnButton).CornerRadius = UDim.new(0,8)

respawnButton.MouseButton1Click:Connect(function()
	if LocalPlayer.Character then
		LocalPlayer.Character:BreakJoints()
	end
end)

-- =======================
-- AIMBOT TAB
-- =======================
local aimbotButton = Instance.new("TextButton", aimbotContent)
aimbotButton.Size = UDim2.new(0.4,0,0,40)
aimbotButton.Position = UDim2.new(0.05,0,0.05,0)
aimbotButton.Text = "Aimbot Aus"
aimbotButton.BackgroundColor3 = Color3.fromRGB(80,80,80)
aimbotButton.Font = Enum.Font.SourceSansBold
aimbotButton.TextSize = 20
aimbotButton.TextColor3 = Color3.fromRGB(255,255,255)
Instance.new("UICorner",aimbotButton).CornerRadius = UDim.new(0,8)

local fovSliderFrame = Instance.new("Frame", aimbotContent)
fovSliderFrame.Size = UDim2.new(0.9,0,0,20)
fovSliderFrame.Position = UDim2.new(0.05,0,0.3,0)
fovSliderFrame.BackgroundColor3 = Color3.fromRGB(70,70,70)
Instance.new("UICorner",fovSliderFrame).CornerRadius = UDim.new(0,10)

local fovSliderButton = Instance.new("Frame", fovSliderFrame)
fovSliderButton.Size = UDim2.new(0,20,1,0)
fovSliderButton.Position = UDim2.new((fovValue-10)/(300-10),-10,0,0)
fovSliderButton.BackgroundColor3 = Color3.fromRGB(0,255,0)
Instance.new("UICorner",fovSliderButton).CornerRadius = UDim.new(1,0)

local fovLabel = Instance.new("TextLabel", aimbotContent)
fovLabel.Size = UDim2.new(1,0,0,30)
fovLabel.Position = UDim2.new(0,0,0.45,0)
fovLabel.Text = "FOV: "..fovValue
fovLabel.TextColor3 = Color3.fromRGB(255,255,255)
fovLabel.BackgroundTransparency = 1
fovLabel.Font = Enum.Font.SourceSans
fovLabel.TextSize = 20

local fovCircle = Drawing.new("Circle")
fovCircle.Thickness = 2
fovCircle.NumSides = 50
fovCircle.Radius = fovValue
fovCircle.Filled = false
fovCircle.Visible = false
fovCircle.Color = Color3.fromRGB(0,255,0)

RunService.RenderStepped:Connect(function()
	fovCircle.Position = UIS:GetMouseLocation()
end)

-- =======================
-- MINIMIZE SYSTEM
-- =======================
local minimized = false
minimizeButton.MouseButton1Click:Connect(function()
	if not minimized then
		categoryFrame.Visible = false
		contentFrame.Visible = false
		mainFrame.Size = UDim2.new(0,400,0,35)
		minimizeButton.Text = "+"
		minimized = true
	else
		categoryFrame.Visible = true
		contentFrame.Visible = true
		mainFrame.Size = UDim2.new(0,400,0,300)
		minimizeButton.Text = "-"
		minimized = false
	end
end)

closeButton.MouseButton1Click:Connect(function()
	mainFrame.Visible = false
end)

-- =======================
-- FLY SYSTEM
-- =======================
local function stopFly()
	flying=false
	flyButton.Text="Aus"
	if bv then bv:Destroy() bv=nil end
	if bg then bg:Destroy() bg=nil end
	local char=LocalPlayer.Character
	if char and char:FindFirstChild("Humanoid") then
		char.Humanoid.PlatformStand=false
	end
end

local function startFly()
	local char=LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
	local hrp=char:WaitForChild("HumanoidRootPart")
	flying=true
	flyButton.Text="An"

	bv=Instance.new("BodyVelocity",hrp)
	bv.MaxForce=Vector3.new(1e5,1e5,1e5)
	bv.Velocity=Vector3.zero

	bg=Instance.new("BodyGyro",hrp)
	bg.MaxTorque=Vector3.new(1e5,1e5,1e5)
	bg.P=9e4
	bg.CFrame=hrp.CFrame

	char.Humanoid.PlatformStand=true
end

flyButton.MouseButton1Click:Connect(function()
	if flying then stopFly() else startFly() end
end)

RunService.RenderStepped:Connect(function()
	if flying and bv and bg then
		local char=LocalPlayer.Character
		local hrp=char and char:FindFirstChild("HumanoidRootPart")
		if not hrp then return end

		local camCF=workspace.CurrentCamera.CFrame
		local moveVec=Vector3.new()
		if UIS:IsKeyDown(Enum.KeyCode.W) then moveVec+=camCF.LookVector end
		if UIS:IsKeyDown(Enum.KeyCode.S) then moveVec-=camCF.LookVector end
		if UIS:IsKeyDown(Enum.KeyCode.A) then moveVec-=camCF.RightVector end
		if UIS:IsKeyDown(Enum.KeyCode.D) then moveVec+=camCF.RightVector end
		if UIS:IsKeyDown(Enum.KeyCode.E) then moveVec+=Vector3.new(0,1,0) end
		if UIS:IsKeyDown(Enum.KeyCode.Q) then moveVec-=Vector3.new(0,1,0) end

		if moveVec.Magnitude>0 then moveVec=moveVec.Unit*flySpeed end
		bv.Velocity=moveVec
		bg.CFrame=camCF
	end
end)

LocalPlayer.CharacterAdded:Connect(stopFly)

-- =======================
-- SLIDER SYSTEM (Fly)
-- =======================
local function updateSpeedFromX(xPos)
	local relative=math.clamp((xPos-sliderFrame.AbsolutePosition.X)/sliderFrame.AbsoluteSize.X,0,1)
	local newSpeed=math.floor(minSpeed+(maxSpeed-minSpeed)*relative)
	flySpeed=newSpeed
	sliderButton.Position=UDim2.new(relative,-10,0,0)
	speedLabel.Text="Speed: "..flySpeed
end

sliderFrame.InputBegan:Connect(function(input)
	if input.UserInputType==Enum.UserInputType.MouseButton1 or input.UserInputType==Enum.UserInputType.Touch then
		dragging=true
		updateSpeedFromX(input.Position.X)
	end
end)

sliderFrame.InputChanged:Connect(function(input)
	if dragging and (input.UserInputType==Enum.UserInputType.MouseMovement or input.UserInputType==Enum.UserInputType.Touch) then
		updateSpeedFromX(input.Position.X)
	end
end)

UIS.InputEnded:Connect(function(input)
	if input.UserInputType==Enum.UserInputType.MouseButton1 or input.UserInputType==Enum.UserInputType.Touch then
		dragging=false
	end
end)

-- =======================
-- SLIDER SYSTEM (Aimbot)
-- =======================
local function updateFovFromX(xPos)
	local relative=math.clamp((xPos-fovSliderFrame.AbsolutePosition.X)/fovSliderFrame.AbsoluteSize.X,0,1)
	local newFov=math.floor(10+(300-10)*relative)
	fovValue=newFov
	fovSliderButton.Position=UDim2.new(relative,-10,0,0)
	fovLabel.Text="FOV: "..fovValue
	fovCircle.Radius=fovValue
end

fovSliderFrame.InputBegan:Connect(function(input)
	if input.UserInputType==Enum.UserInputType.MouseButton1 or input.UserInputType==Enum.UserInputType.Touch then
		draggingSlider=true
		updateFovFromX(input.Position.X)
	end
end)

fovSliderFrame.InputChanged:Connect(function(input)
	if draggingSlider and (input.UserInputType==Enum.UserInputType.MouseMovement or input.UserInputType==Enum.UserInputType.Touch) then
		updateFovFromX(input.Position.X)
	end
end)

UIS.InputEnded:Connect(function(input)
	if input.UserInputType==Enum.UserInputType.MouseButton1 or input.UserInputType==Enum.UserInputType.Touch then
		draggingSlider=false
	end
end)

-- =======================
-- AIMBOT SYSTEM
-- =======================
local holding=false
UIS.InputBegan:Connect(function(input,gp)
	if gp then return end
	if input.UserInputType==Enum.UserInputType.MouseButton2 or input.UserInputType==Enum.UserInputType.Touch then
		holding=true
	end
end)
UIS.InputEnded:Connect(function(input)
	if input.UserInputType==Enum.UserInputType.MouseButton2 or input.UserInputType==Enum.UserInputType.Touch then
		holding=false
	end
end)

aimbotButton.MouseButton1Click:Connect(function()
	aimbotEnabled=not aimbotEnabled
	aimbotButton.Text= aimbotEnabled and "Aimbot An" or "Aimbot Aus"
	fovCircle.Visible=aimbotEnabled
end)

RunService.RenderStepped:Connect(function()
	if aimbotEnabled and holding then
		local closest,dist
		for _,plr in pairs(Players:GetPlayers()) do
			if plr~=LocalPlayer and plr.Character and plr.Character:FindFirstChild("Head") then
				local pos,visible=Camera:WorldToViewportPoint(plr.Character.Head.Position)
				if visible then
					local mLoc=UIS:GetMouseLocation()
					local mag=(Vector2.new(pos.X,pos.Y)-mLoc).Magnitude
					if mag<=fovValue and (not dist or mag<dist) then
						closest=plr.Character.Head
						dist=mag
					end
				end
			end
		end
		if closest then
			Camera.CFrame=CFrame.new(Camera.CFrame.Position,closest.Position)
		end
	end
end)

-- =======================
-- KEY SYSTEM
-- =======================
textBox.FocusLost:Connect(function(enterPressed)
	if enterPressed then
		if textBox.Text==correctKey then
			keyFrame.Visible=false
			mainFrame.Visible=true
		else
			textBox.Text=""
			textBox.PlaceholderText="Wrong Key!"
		end
	end
end)
